module.exports=[70406,(e,t,r)=>{t.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},93695,(e,t,r)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},874,(e,t,r)=>{t.exports=e.x("buffer",()=>require("buffer"))},92509,(e,t,r)=>{t.exports=e.x("url",()=>require("url"))},21517,(e,t,r)=>{t.exports=e.x("http",()=>require("http"))},49719,(e,t,r)=>{t.exports=e.x("assert",()=>require("assert"))},24836,(e,t,r)=>{t.exports=e.x("https",()=>require("https"))},18622,(e,t,r)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},24725,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},24361,(e,t,r)=>{t.exports=e.x("util",()=>require("util"))},54799,(e,t,r)=>{t.exports=e.x("crypto",()=>require("crypto"))},63021,(e,t,r)=>{t.exports=e.x("@prisma/client-2c3a283f134fdcb6",()=>require("@prisma/client-2c3a283f134fdcb6"))},23862,e=>e.a(async(t,r)=>{try{let t=await e.y("pg-587764f78a6c7a9c");e.n(t),r()}catch(e){r(e)}},!0),45706,(e,t,r)=>{t.exports=e.x("querystring",()=>require("querystring"))},6461,(e,t,r)=>{t.exports=e.x("zlib",()=>require("zlib"))},27699,(e,t,r)=>{t.exports=e.x("events",()=>require("events"))},78295,e=>{e.v({name:"openid-client",version:"5.7.1",description:"OpenID Connect Relying Party (RP, Client) implementation for Node.js runtime, supports passportjs",keywords:["auth","authentication","basic","certified","client","connect","dynamic","electron","hybrid","identity","implicit","oauth","oauth2","oidc","openid","passport","relying party","strategy"],homepage:"https://github.com/panva/openid-client",repository:"panva/openid-client",funding:{url:"https://github.com/sponsors/panva"},license:"MIT",author:"Filip Skokan <panva.ip@gmail.com>",exports:{types:"./types/index.d.ts",import:"./lib/index.mjs",require:"./lib/index.js"},main:"./lib/index.js",types:"./types/index.d.ts",files:["lib","types/index.d.ts"],scripts:{format:"npx prettier --loglevel silent --write ./lib ./test ./certification ./types",test:"mocha test/**/*.test.js"},dependencies:{jose:"^4.15.9","lru-cache":"^6.0.0","object-hash":"^2.2.0","oidc-token-hash":"^5.0.3"},devDependencies:{"@types/node":"^16.18.106","@types/passport":"^1.0.16",base64url:"^3.0.1",chai:"^4.5.0",mocha:"^10.7.3",nock:"^13.5.5",prettier:"^2.8.8","readable-mock-req":"^0.2.2",sinon:"^9.2.4",timekeeper:"^2.3.1"},"standard-version":{scripts:{postchangelog:"sed -i '' -e 's/### \\[/## [/g' CHANGELOG.md"},types:[{type:"feat",section:"Features"},{type:"fix",section:"Fixes"},{type:"chore",hidden:!0},{type:"docs",hidden:!0},{type:"style",hidden:!0},{type:"refactor",section:"Refactor",hidden:!1},{type:"perf",section:"Performance",hidden:!1},{type:"test",hidden:!0}]}})},26682,e=>{"use strict";let t=/https?:\/\/[^\s<>"{}|\\^`\[\]]+/gi,r=/^\d{1,2}:\d{2}(:\d{2})?$/,a=/^mailto:|@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/,n=["amazon.com","amazon.co.uk","amazon.ca","amazon.de","amazon.fr","amazon.es","amazon.it","amazon.co.jp","amazon.com.au","amazon.in","amzn.to","amzn.com","a.co"],i=/\/(?:dp|gp\/product|ASIN)\/([A-Z0-9]{10})/i,s=/[?&](?:asin|ASIN)=([A-Z0-9]{10})/i,o=["utm_source","utm_medium","utm_campaign","utm_term","utm_content","ref","ref_","linkCode","linkId","pd_rd_i","pd_rd_r","pd_rd_w","pd_rd_wg","pf_rd_i","pf_rd_m","pf_rd_p","pf_rd_r","pf_rd_s","pf_rd_t","psc","smid","spLa","sr","th","fbclid","gclid","dclid"];function l(e){if(!e)return[];let l=e.match(t)||[],u=new Set,c=[];for(let e of l){let t=e.replace(/[.,;:!?)]+$/,"");if(r.test(t)||a.test(t))continue;let l=function(e){try{let t=new URL(e);return o.forEach(e=>{t.searchParams.delete(e)}),t.hash&&t.hash.includes("ref=")&&(t.hash=""),t.toString()}catch{return e}}(t);if(u.has(l))continue;u.add(l);let d=function(e){try{let t=new URL(e).hostname.toLowerCase();return n.some(e=>t===e||t.endsWith(`.${e}`))}catch{return!1}}(l),p=d?function(e){let t=e.match(i);if(t)return t[1];let r=e.match(s);if(r)return r[1]}(l):void 0;c.push({url:l,merchant:d?"amazon":"other",asin:p})}return c}function u(e){return e.filter(e=>"amazon"===e.merchant)}e.s(["extractLinksFromDescription",()=>l,"filterAffiliateLinks",()=>u])},88676,e=>{"use strict";let t=["Currently unavailable","Out of stock","We don't know when or if this item will be back","This item is not available","We don't know when or if this item will be back in stock","Available from these sellers","Sign up to be notified when this item becomes available"],r=["Page not found","404","Product not found","This page doesn't exist","Sorry, we couldn't find that page","The page you requested could not be found"];function a(e){let t=e.toLowerCase();return r.some(e=>t.includes(e.toLowerCase()))}async function n(e,t={},r=1e4){let a=new AbortController,i=setTimeout(()=>a.abort(),r);try{return await fetch(e,{...t,signal:a.signal,redirect:"follow",headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36",Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8","Accept-Language":"en-US,en;q=0.5",...t.headers}})}finally{clearTimeout(i)}}async function i(e,r=!1){let s=null;for(let i=0;i<=2;i++){i>0&&await function(e){return new Promise(t=>setTimeout(t,e))}(1e3*Math.pow(2,i-1));try{let i;try{i=await n(e,{method:"HEAD"})}catch{i=await n(e,{method:"GET"})}let s=i.status,o=i.url;if(404===s||410===s)return{status:"NOT_FOUND",httpStatus:s,finalUrl:o,availabilityStatus:"broken",notes:`HTTP ${s}`};if(s>=400)return{status:"NOT_FOUND",httpStatus:s,finalUrl:o,availabilityStatus:"error",notes:`HTTP ${s}`};if(r&&200===s){let r=await n(e,{method:"GET"}),i=await r.text();if(a(i))return{status:"NOT_FOUND",httpStatus:s,finalUrl:r.url,availabilityStatus:"error_page",notes:"Redirected to error page"};if(function(e){let r=e.toLowerCase();return t.some(e=>r.includes(e.toLowerCase()))}(i))return{status:"OOS",httpStatus:s,finalUrl:r.url,availabilityStatus:"out_of_stock",notes:"Product appears to be out of stock"}}if(s>=200&&s<300){if(o!==e){let t=await n(e,{method:"GET"}),r=await t.text();if(a(r))return{status:"NOT_FOUND",httpStatus:s,finalUrl:t.url,availabilityStatus:"error_page",notes:"Redirected to error page"}}return{status:"OK",httpStatus:s,finalUrl:o,availabilityStatus:"available",notes:null}}if(s>=300&&s<400)return{status:"REDIRECT",httpStatus:s,finalUrl:o,availabilityStatus:"redirect",notes:`Redirected to ${o}`};return{status:"OK",httpStatus:s,finalUrl:o,availabilityStatus:"available",notes:null}}catch(e){if(s=e instanceof Error?e:Error(String(e)),2===i){let e="AbortError"===s.name||s.message.includes("timeout");return{status:"UNKNOWN",httpStatus:null,finalUrl:null,availabilityStatus:e?"timeout":"error",notes:e?"Request timed out":`Error: ${s.message}`}}}}return{status:"UNKNOWN",httpStatus:null,finalUrl:null,availabilityStatus:"error",notes:s?.message||"Unknown error"}}e.s(["checkLink",()=>i])},30421,e=>e.a(async(t,r)=>{try{var a=e.i(43793),n=e.i(26682),i=e.i(88676),s=t([a]);async function o(e){let t=await a.prisma.video.findMany({where:{userId:e},select:{id:!0,description:!0}}),r=0;for(let e of t){if(!e.description)continue;let t=(0,n.extractLinksFromDescription)(e.description);for(let i of(0,n.filterAffiliateLinks)(t))!await a.prisma.affiliateLink.findFirst({where:{videoId:e.id,originalUrl:i.url}})&&(await a.prisma.affiliateLink.create({data:{videoId:e.id,originalUrl:i.url,merchant:i.merchant}}),r++)}return{videos:t.length,links:r}}async function l(e,t=7){let r=new Date;r.setDate(r.getDate()-t);let n=await a.prisma.affiliateLink.findMany({where:{video:{userId:e},OR:[{lastCheckedAt:null},{lastCheckedAt:{lt:r}}]},select:{id:!0,originalUrl:!0,merchant:!0},take:100}),s=0,o=0;for(let e of n)try{let t="amazon"===e.merchant,r=await (0,i.checkLink)(e.originalUrl,t);await a.prisma.affiliateLink.update({where:{id:e.id},data:{status:r.status,lastCheckedAt:new Date}}),await a.prisma.scanResult.create({data:{affiliateLinkId:e.id,httpStatus:r.httpStatus,availabilityStatus:r.availabilityStatus,notes:r.notes}}),s++,("NOT_FOUND"===r.status||"OOS"===r.status)&&o++,await new Promise(e=>setTimeout(e,500))}catch(t){console.error(`Error checking link ${e.id}:`,t)}return{checked:s,issues:o}}async function u(e){let t=await a.prisma.affiliateLink.findMany({where:{video:{userId:e}},select:{status:!0,lastCheckedAt:!0}});return{totalLinks:t.length,checkedLinks:t.filter(e=>e.lastCheckedAt).length,okLinks:t.filter(e=>"OK"===e.status).length,brokenLinks:t.filter(e=>"NOT_FOUND"===e.status).length,oosLinks:t.filter(e=>"OOS"===e.status).length,unknownLinks:t.filter(e=>"UNKNOWN"===e.status).length}}[a]=s.then?(await s)():s,e.s(["extractLinksForUser",()=>o,"getScanStats",()=>u,"scanUserLinks",()=>l]),r()}catch(e){r(e)}},!1),84450,e=>e.a(async(t,r)=>{try{var a=e.i(89171),n=e.i(57660),i=e.i(79832),s=e.i(30421),o=t([i,s]);async function l(){try{let e=await (0,n.getServerSession)(i.authOptions);if(!e?.user?.id)return a.NextResponse.json({error:"Unauthorized"},{status:401});let{checked:t,issues:r}=await (0,s.scanUserLinks)(e.user.id),o=await (0,s.getScanStats)(e.user.id);return a.NextResponse.json({success:!0,checked:t,issuesFound:r,stats:o})}catch(e){return console.error("Error scanning links:",e),a.NextResponse.json({error:"Failed to scan links"},{status:500})}}async function u(){try{let e=await (0,n.getServerSession)(i.authOptions);if(!e?.user?.id)return a.NextResponse.json({error:"Unauthorized"},{status:401});let t=await (0,s.getScanStats)(e.user.id);return a.NextResponse.json({stats:t})}catch(e){return console.error("Error getting scan stats:",e),a.NextResponse.json({error:"Failed to get scan stats"},{status:500})}}[i,s]=o.then?(await o)():o,e.s(["GET",()=>u,"POST",()=>l]),r()}catch(e){r(e)}},!1),16057,e=>e.a(async(t,r)=>{try{var a=e.i(47909),n=e.i(74017),i=e.i(96250),s=e.i(59756),o=e.i(61916),l=e.i(74677),u=e.i(69741),c=e.i(16795),d=e.i(87718),p=e.i(95169),h=e.i(47587),f=e.i(66012),m=e.i(70101),x=e.i(26937),y=e.i(10372),g=e.i(93695);e.i(52474);var w=e.i(220),v=e.i(84450),k=t([v]);[v]=k.then?(await k)():k;let S=new a.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/scan/route",pathname:"/api/scan",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/api/scan/route.ts",nextConfigOutput:"",userland:v}),{workAsyncStorage:E,workUnitAsyncStorage:_,serverHooks:N}=S;function b(){return(0,i.patchFetch)({workAsyncStorage:E,workUnitAsyncStorage:_})}async function R(e,t,r){S.isDev&&(0,s.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let a="/api/scan/route";a=a.replace(/\/index$/,"")||"/";let i=await S.prepare(e,t,{srcPage:a,multiZoneDraftMode:!1});if(!i)return t.statusCode=400,t.end("Bad Request"),null==r.waitUntil||r.waitUntil.call(r,Promise.resolve()),null;let{buildId:v,params:k,nextConfig:b,parsedUrl:R,isDraftMode:E,prerenderManifest:_,routerServerContext:N,isOnDemandRevalidate:C,revalidateOnlyGenerated:O,resolvedPathname:A,clientReferenceManifest:T,serverActionsManifest:U}=i,q=(0,u.normalizeAppPath)(a),L=!!(_.dynamicRoutes[q]||_.routes[A]),P=async()=>((null==N?void 0:N.render404)?await N.render404(e,t,R,!1):t.end("This page could not be found"),null);if(L&&!E){let e=!!_.routes[A],t=_.dynamicRoutes[q];if(t&&!1===t.fallback&&!e){if(b.experimental.adapterPath)return await P();throw new g.NoFallbackError}}let j=null;!L||S.isDev||E||(j=A,j="/index"===j?"/":j);let D=!0===S.isDev||!L,F=L&&!D;U&&T&&(0,l.setManifestsSingleton)({page:a,clientReferenceManifest:T,serverActionsManifest:U});let I=e.method||"GET",z=(0,o.getTracer)(),H=z.getActiveScopeSpan(),M={params:k,prerenderManifest:_,renderOpts:{experimental:{authInterrupts:!!b.experimental.authInterrupts},cacheComponents:!!b.cacheComponents,supportsDynamicResponse:D,incrementalCache:(0,s.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:b.cacheLife,waitUntil:r.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,a,n)=>S.onRequestError(e,t,a,n,N)},sharedContext:{buildId:v}},$=new c.NodeNextRequest(e),K=new c.NodeNextResponse(t),W=d.NextRequestAdapter.fromNodeNextRequest($,(0,d.signalFromNodeResponse)(t));try{let i=async e=>S.handle(W,M).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=z.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==p.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let n=r.get("next.route");if(n){let t=`${I} ${n}`;e.setAttributes({"next.route":n,"http.route":n,"next.span_name":t}),e.updateName(t)}else e.updateName(`${I} ${a}`)}),l=!!(0,s.getRequestMeta)(e,"minimalMode"),u=async s=>{var o,u;let c=async({previousCacheEntry:n})=>{try{if(!l&&C&&O&&!n)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let a=await i(s);e.fetchMetrics=M.renderOpts.fetchMetrics;let o=M.renderOpts.pendingWaitUntil;o&&r.waitUntil&&(r.waitUntil(o),o=void 0);let u=M.renderOpts.collectedTags;if(!L)return await (0,f.sendResponse)($,K,a,M.renderOpts.pendingWaitUntil),null;{let e=await a.blob(),t=(0,m.toNodeOutgoingHttpHeaders)(a.headers);u&&(t[y.NEXT_CACHE_TAGS_HEADER]=u),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==M.renderOpts.collectedRevalidate&&!(M.renderOpts.collectedRevalidate>=y.INFINITE_CACHE)&&M.renderOpts.collectedRevalidate,n=void 0===M.renderOpts.collectedExpire||M.renderOpts.collectedExpire>=y.INFINITE_CACHE?void 0:M.renderOpts.collectedExpire;return{value:{kind:w.CachedRouteKind.APP_ROUTE,status:a.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:n}}}}catch(t){throw(null==n?void 0:n.isStale)&&await S.onRequestError(e,t,{routerKind:"App Router",routePath:a,routeType:"route",revalidateReason:(0,h.getRevalidateReason)({isStaticGeneration:F,isOnDemandRevalidate:C})},!1,N),t}},d=await S.handleResponse({req:e,nextConfig:b,cacheKey:j,routeKind:n.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:_,isRoutePPREnabled:!1,isOnDemandRevalidate:C,revalidateOnlyGenerated:O,responseGenerator:c,waitUntil:r.waitUntil,isMinimalMode:l});if(!L)return null;if((null==d||null==(o=d.value)?void 0:o.kind)!==w.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==d||null==(u=d.value)?void 0:u.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});l||t.setHeader("x-nextjs-cache",C?"REVALIDATED":d.isMiss?"MISS":d.isStale?"STALE":"HIT"),E&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let p=(0,m.fromNodeOutgoingHttpHeaders)(d.value.headers);return l&&L||p.delete(y.NEXT_CACHE_TAGS_HEADER),!d.cacheControl||t.getHeader("Cache-Control")||p.get("Cache-Control")||p.set("Cache-Control",(0,x.getCacheControlHeader)(d.cacheControl)),await (0,f.sendResponse)($,K,new Response(d.value.body,{headers:p,status:d.value.status||200})),null};H?await u(H):await z.withPropagatedContext(e.headers,()=>z.trace(p.BaseServerSpan.handleRequest,{spanName:`${I} ${a}`,kind:o.SpanKind.SERVER,attributes:{"http.method":I,"http.target":e.url}},u))}catch(t){if(t instanceof g.NoFallbackError||await S.onRequestError(e,t,{routerKind:"App Router",routePath:q,routeType:"route",revalidateReason:(0,h.getRevalidateReason)({isStaticGeneration:F,isOnDemandRevalidate:C})},!1,N),L)throw t;return await (0,f.sendResponse)($,K,new Response(null,{status:500})),null}}e.s(["handler",()=>R,"patchFetch",()=>b,"routeModule",()=>S,"serverHooks",()=>N,"workAsyncStorage",()=>E,"workUnitAsyncStorage",()=>_]),r()}catch(e){r(e)}},!1)];

//# sourceMappingURL=%5Broot-of-the-server%5D__f039ebe0._.js.map